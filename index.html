<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxMate - Simple Tax Calculator for UK Freelancers</title>
    <script defer src="https://unpkg.com/alpinejs@3.13.5/dist/cdn.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script>
        function taxmate() {
            return {
                showCalculator: false,
                currentStep: 1,
                workType: '',
                customWorkType: '',
                income: '',
                frequency: 'monthly',
                hasExpenses: false,
                showExplanation: false,
                showExpenseHelp: false,
                showExpenses: false,
                showBreakdown: false,
                showError: false,
                showIncomeHelp: false,
                results: null,
                explanation: null,
                explanationLoading: false,
                showGlossary: false,
                showFAQ: false,
                bufferEnabled: false,
                faqItems: [
                    {
                        question: 'Do I need to register for tax?',
                        answer: 'Yes, if you earn more than ¬£1,000 from freelancing in a tax year, you need to register as self-employed with HMRC.'
                    },
                    {
                        question: 'When is the tax deadline?',
                        answer: 'The Self Assessment deadline is January 31st for online returns. You need to submit your return and pay any tax you owe for the previous tax year by this date.'
                    },
                    {
                        question: 'What if my income changes each month?',
                        answer: 'That\'s normal for freelancers! Use your best estimate and adjust your savings as your income changes. It\'s better to save a little extra than not enough.'
                    }
                ],
                freelancerType: '',
                customFreelancerType: '',
                waitlistEmail: '',
                waitlistSuccess: false,
                waitlistError: '',
                waitlistLoading: false,
                showWaitlist: false,

                // Progress indicator text
                get stepText() {
                    return `Step ${this.currentStep} of 3`;
                },

                // Freelancer type options
                freelancerTypes: [
                    { icon: 'üì∏', label: 'Photographer / Videographer' },
                    { icon: 'üé®', label: 'Graphic / Web Designer' },
                    { icon: '‚úçÔ∏è', label: 'Writer / Content Creator' },
                    { icon: 'üé≠', label: 'Performer / Creative Artist' },
                    { icon: 'üë•', label: 'Coach / Consultant' },
                    { icon: 'üíª', label: 'Developer / Software Engineer' },
                    { icon: 'üîß', label: 'Tradesperson / Contractor' },
                    { icon: 'üìö', label: 'Tutor / Online Instructor' },
                    { icon: 'üßò', label: 'Therapist / Wellness Practitioner' },
                    { icon: '‚ú®', label: 'Other' }
                ],

                init() {
                    console.log('Alpine initialized');
                    // Load expenses from localStorage
                    const savedExpenses = localStorage.getItem('taxmate_expenses');
                    if (savedExpenses) {
                        this.expenses = JSON.parse(savedExpenses);
                    }
                },

                resetCalculator() {
                    this.income = '';
                    this.results = null;
                    this.frequency = 'annual';
                    this.currentStep = 1;
                    this.workType = '';
                    this.customWorkType = '';
                    this.showExplanation = false;
                    this.showExpenses = false;
                    this.hasExpenses = false;
                },

                formatCurrency(amount) {
                    return new Intl.NumberFormat('en-GB', {
                        style: 'currency',
                        currency: 'GBP'
                    }).format(amount);
                },

                nextStep() {
                    if (this.currentStep < 3) {
                        this.currentStep++;
                        if (this.currentStep === 3) {
                            this.calculateTax();
                        }
                    }
                },

                prevStep() {
                    if (this.currentStep > 1) {
                        this.currentStep--;
                    }
                },

                calculateTax() {
                    console.log('Calculating tax...', this.income, this.frequency, this.freelancerType);
                    const annualIncome = this.frequency === 'monthly' ? this.income * 12 : this.income;
                    
                    let incomeTax = 0;
                    if (annualIncome > 12570) {
                        const taxableIncome = Math.min(annualIncome - 12570, 37700);
                        incomeTax = taxableIncome * 0.2;
                    }

                    const class2NI = annualIncome > 6725 ? 3.45 * 52 : 0;
                    let class4NI = 0;

                    if (annualIncome > 12570) {
                        const niTaxable = Math.min(annualIncome - 12570, 37700);
                        class4NI = niTaxable * 0.09;
                    }

                    const total = incomeTax + class2NI + class4NI;

                    this.results = {
                        incomeTax: incomeTax.toFixed(2),
                        class2NI: class2NI.toFixed(2),
                        class4NI: class4NI.toFixed(2),
                        total: total.toFixed(2),
                        monthlySetAside: (total / 12).toFixed(2)
                    };
                    
                    console.log('Results:', this.results);
                },

                toggleBuffer() {
                    this.bufferEnabled = !this.bufferEnabled;
                    if (this.results) {
                        this.calculateTax();
                    }
                },

                async explainTax() {
                    if (!this.results) return;
                    
                    this.explanationLoading = true;
                    try {
                        const response = await fetch('https://api.openai.com/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.apiKey}`
                            },
                            body: JSON.stringify({
                                model: "gpt-3.5-turbo",
                                messages: [{
                                    role: "system",
                                    content: "You are a friendly tax advisor. Explain tax calculations in simple terms."
                                }, {
                                    role: "user",
                                    content: `Please explain this UK tax calculation in simple terms:
                                    Annual Income: ¬£${this.income}
                                    Taxable Income: ¬£${this.results.taxableIncome}
                                    Income Tax: ¬£${this.results.incomeTax}
                                    Class 2 NI: ¬£${this.results.class2NI}
                                    Class 4 NI: ¬£${this.results.class4NI}
                                    Total Tax: ¬£${this.results.total}
                                    Monthly Set Aside: ¬£${this.results.monthlySetAside}`
                                }]
                            })
                        });
                        
                        const data = await response.json();
                        this.explanation = data.choices[0].message.content;
                    } catch (error) {
                        this.explanation = "Sorry, I couldn't generate an explanation right now. Please try again later.";
                    } finally {
                        this.explanationLoading = false;
                    }
                },

                handleExpenseChoice(hasExpenses, defaultCategories = []) {
                    this.hasExpenses = hasExpenses;
                    if (hasExpenses) {
                        this.expenseCategories = defaultCategories;
                    }
                    this.calculateTax();
                    this.currentStep = 3;
                },

                selectFreelancerType(type) {
                    this.freelancerType = type;
                    this.currentStep = 2;
                },

                submitIncome() {
                    if (this.income) {
                        this.calculateTax();
                        this.currentStep = 3;
                    }
                },

                async joinWaitlist() {
                    // Input validation
                    if (!this.waitlistEmail || !this.waitlistEmail.includes('@')) {
                        this.waitlistError = 'Please enter a valid email address';
                        return;
                    }

                    this.waitlistLoading = true;
                    this.waitlistError = '';

                    try {
                        // For testing/development
                        if (window.location.protocol === 'file:' || window.location.hostname === 'localhost') {
                            // Simulate API call
                            await new Promise(resolve => setTimeout(resolve, 1000));
                            
                            // Simulate success
                            this.waitlistSuccess = true;
                            this.waitlistEmail = '';
                            
                            // Auto-close modal after 3 seconds
                            setTimeout(() => {
                                this.showWaitlist = false;
                                this.waitlistSuccess = false;
                            }, 3000);
                            
                            return;
                        }

                        // Production API call
                        const response = await fetch('https://naqwxvftogtcfyonyybz.supabase.co/rest/v1/waitlist_emails', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5hcXd4dmZ0b2d0Y2Z5b255eWJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyOTQ2MzgsImV4cCI6MjA2Mzg3MDYzOH0.16fPoeENjLqBOuNusSixKNRMBO7oI8QsTRGXUE61UjE',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5hcXd4dmZ0b2d0Y2Z5b255eWJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyOTQ2MzgsImV4cCI6MjA2Mzg3MDYzOH0.16fPoeENjLqBOuNusSixKNRMBO7oI8QsTRGXUE61UjE',
                                'Prefer': 'return=minimal'
                            },
                            body: JSON.stringify({
                                email: this.waitlistEmail.toLowerCase().trim(),
                                freelancer_type: this.freelancerType || 'Not specified',
                                signup_date: new Date().toISOString()
                            })
                        });

                        if (!response.ok) {
                            const errorData = await response.json().catch(() => ({}));
                            console.error('Signup error:', errorData);
                            
                            if (response.status === 409 || (errorData.message && errorData.message.includes('duplicate'))) {
                                throw new Error('This email is already on the waitlist!');
                            } else if (response.status === 400) {
                                throw new Error('Please enter a valid email address');
                            } else {
                                throw new Error('Failed to join waitlist. Please try again.');
                            }
                        }

                        // Success!
                        this.waitlistSuccess = true;
                        this.waitlistEmail = '';
                        
                        // Auto-close modal after 3 seconds
                        setTimeout(() => {
                            this.showWaitlist = false;
                            this.waitlistSuccess = false;
                        }, 3000);

                    } catch (error) {
                        console.error('Waitlist error:', error);
                        this.waitlistError = error.message || 'Something went wrong. Please try again.';
                        this.waitlistSuccess = false;
                    } finally {
                        this.waitlistLoading = false;
                    }
                },

                startCalculator() {
                    this.showCalculator = true;
                    // Smooth scroll to calculator
                    this.$nextTick(() => {
                        document.getElementById('calculator').scrollIntoView({ behavior: 'smooth' });
                    });
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-800">
    <div x-data="taxmate()" class="min-h-screen">
        <!-- Header -->
        <header class="bg-white border-b border-gray-100 py-4 px-6 fixed w-full top-0 z-50">
            <div class="container mx-auto">
                <div class="flex items-center justify-between">
                    <a href="/" class="flex items-center space-x-2 text-blue-900 hover:text-blue-700 transition-colors">
                        <span class="text-2xl">üìä</span>
                        <span class="font-bold text-xl">Taxulator</span>
                    </a>
                    <nav class="hidden md:flex items-center space-x-6">
                        <a 
                            href="#features" 
                            class="text-gray-600 hover:text-blue-600 transition-colors"
                            @click.prevent="document.getElementById('features').scrollIntoView({ behavior: 'smooth' })"
                        >
                            Features
                        </a>
                        <button 
                            @click="startCalculator()" 
                            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                        >
                            Try Now
                        </button>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Landing Page -->
        <section 
            x-show="!showCalculator"
            class="min-h-screen flex flex-col pt-16"
        >
            <!-- Hero Section -->
            <div class="bg-blue-900 py-16 md:py-24">
                <div class="container mx-auto px-6">
                    <!-- Main Content -->
                    <div class="max-w-3xl mx-auto text-center">
                        <h1 class="text-4xl md:text-6xl font-bold leading-tight text-white text-balance mb-8">
                            No more tax guesswork. Just clarity for UK freelancers.
                        </h1>
                        <h2 class="text-xl md:text-2xl text-blue-100 leading-relaxed max-w-2xl mx-auto mb-12">
                            Taxulator helps freelancers know exactly what to set aside ‚Äî with zero jargon.
                        </h2>

                        <!-- Video Preview -->
                        <div class="max-w-4xl mx-auto mb-12">
                            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                                <div class="relative w-full" style="padding-top: 56.25%"> <!-- 16:9 Aspect Ratio -->
                                    <div 
                                        x-data="{ playing: false }"
                                        class="absolute top-0 left-0 w-full h-full"
                                    >
                                        <video 
                                            class="absolute top-0 left-0 w-full h-full object-cover"
                                            x-ref="video"
                                            loop 
                                            muted 
                                            playsinline
                                            poster="public/preview-poster.png"
                                        >
                                            <source src="public/preview.mp4" type="video/mp4">
                                        </video>
                                        
                                        <!-- Play Button Overlay -->
                                        <div
                                            x-show="!playing"
                                            class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 cursor-pointer hover:bg-opacity-40 transition-opacity"
                                            @click="playing = true; $refs.video.play()"
                                        >
                                            <div class="w-20 h-20 rounded-full bg-white bg-opacity-90 flex items-center justify-center">
                                                <svg class="w-10 h-10 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
                                                </svg>
                                            </div>
                                        </div>

                                        <!-- Pause Overlay (only visible when playing) -->
                                        <div
                                            x-show="playing"
                                            class="absolute inset-0 cursor-pointer"
                                            @click="playing = false; $refs.video.pause()"
                                        ></div>
                                    </div>
                                </div>
                                <div class="p-4 text-center text-sm text-gray-600">
                                    A quick look at how Taxulator works
                                </div>
                            </div>
                        </div>

                        <!-- CTA Button -->
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <button 
                                @click="startCalculator()"
                                class="w-full sm:w-auto bg-white text-blue-900 px-8 py-4 rounded-lg text-lg font-semibold hover:bg-blue-50 transform hover:scale-105 transition-all duration-200 flex items-center justify-center shadow-lg"
                            >
                                Calculate Your Tax
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Try It Now Section -->
            <div class="py-16 bg-white">
                <div class="container mx-auto px-6">
                    <div class="text-center max-w-3xl mx-auto mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4 text-balance">
                            Try it now ‚Äî no signup needed
                        </h2>
                        <p class="text-xl text-gray-600 max-w-2xl mx-auto text-balance">
                            Estimate your tax bill and what to save monthly.
                        </p>
                    </div>

                    <div class="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto">
                        <div class="bg-gray-50 rounded-xl p-6 text-center">
                            <div class="text-3xl mb-4">‚úÖ</div>
                            <h3 class="font-semibold text-gray-900 mb-2">Tax estimate</h3>
                            <p class="text-gray-600">Clear breakdown of Income Tax and National Insurance</p>
                        </div>
                        <div class="bg-gray-50 rounded-xl p-6 text-center">
                            <div class="text-3xl mb-4">üí∑</div>
                            <h3 class="font-semibold text-gray-900 mb-2">Monthly savings</h3>
                            <p class="text-gray-600">Know exactly what to set aside each month</p>
                        </div>
                        <div class="bg-gray-50 rounded-xl p-6 text-center">
                            <div class="text-3xl mb-4">ü§ì</div>
                            <h3 class="font-semibold text-gray-900 mb-2">Plain English</h3>
                            <p class="text-gray-600">Simple explanations without the tax jargon</p>
                        </div>
                    </div>

                    <div class="text-center mt-12">
                        <button 
                            @click="startCalculator()"
                            class="w-full sm:w-auto bg-blue-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-blue-700 transition-all duration-200 inline-flex items-center justify-center"
                        >
                            Start Calculating
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Coming Soon Section -->
            <div id="features" class="py-16 bg-gray-50">
                <div class="container mx-auto px-6">
                    <div class="text-center max-w-3xl mx-auto mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4 text-balance">
                            Smart features coming soon
                        </h2>
                    </div>

                    <div class="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                        <div class="flex items-start space-x-4">
                            <div class="text-2xl flex-shrink-0">üßæ</div>
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2">Smart expense tracker</h3>
                                <p class="text-gray-600">Automatically categorize and track business expenses</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="text-2xl flex-shrink-0">üìÖ</div>
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2">Tax deadline reminders</h3>
                                <p class="text-gray-600">Never miss an important HMRC deadline</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="text-2xl flex-shrink-0">üß†</div>
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2">Self Assessment help</h3>
                                <p class="text-gray-600">Step-by-step guidance for filing your return</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="text-2xl flex-shrink-0">üìÇ</div>
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2">HMRC-ready exports</h3>
                                <p class="text-gray-600">Export your data in HMRC-compatible formats</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="text-2xl flex-shrink-0">üìä</div>
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2">Visual insights</h3>
                                <p class="text-gray-600">Beautiful charts to track your business growth</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="text-2xl flex-shrink-0">üé®</div>
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2">Industry guidance</h3>
                                <p class="text-gray-600">Tailored tax tips for your profession</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Waitlist Section -->
            <div class="py-16 bg-blue-50">
                <div class="container mx-auto px-6">
                    <div class="max-w-2xl mx-auto text-center">
                        <h2 class="text-3xl font-bold text-gray-900 mb-4 text-balance">
                            üíå Be the first to know when we launch
                        </h2>
                        <p class="text-xl text-gray-600 mb-8 text-balance">
                            Join the waitlist to access Taxulator Pro when it's ready.
                        </p>

                        <form @submit.prevent="joinWaitlist()" class="max-w-md mx-auto">
                            <div class="flex flex-col sm:flex-row gap-3">
                                <input 
                                    type="email" 
                                    x-model="waitlistEmail"
                                    placeholder="Enter your email"
                                    class="flex-1 px-4 py-3 rounded-lg border-2 border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    :class="{'border-red-300': waitlistError}"
                                >
                                <button 
                                    type="submit"
                                    class="w-full sm:w-auto bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-150 disabled:opacity-50"
                                    :class="{'bg-green-600 hover:bg-green-600': waitlistSuccess}"
                                    :disabled="waitlistLoading || waitlistSuccess"
                                >
                                    <span x-show="!waitlistSuccess">Join Waitlist</span>
                                    <span x-show="waitlistSuccess">‚úÖ You're on the list!</span>
                                </button>
                            </div>
                            <!-- Error Message -->
                            <div 
                                x-show="waitlistError" 
                                x-text="waitlistError"
                                class="text-red-600 text-sm mt-2"
                            ></div>
                            <p class="text-sm text-gray-500 mt-3">No spam. Just helpful updates.</p>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Calculator Section -->
        <div 
            id="calculator" 
            x-show="showCalculator"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            class="container mx-auto px-6 py-12"
        >
            <!-- Progress Indicator -->
            <div class="max-w-4xl mx-auto px-4 py-6">
                <div class="text-sm text-gray-600 font-medium" x-text="stepText"></div>
            </div>

            <!-- Step 1: Freelancer Type Selection -->
            <div x-show="currentStep === 1" 
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 class="max-w-4xl mx-auto px-4 py-8"
            >
                <div class="bg-white shadow-md rounded-2xl p-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">What kind of freelancer are you?</h2>
                    <p class="text-gray-600 mb-8">This helps us provide relevant tax tips and expense categories.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <template x-for="type in freelancerTypes" :key="type.label">
                            <button 
                                @click="selectFreelancerType(type.label)"
                                class="flex items-center p-4 rounded-xl border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all duration-150"
                                :class="{'border-blue-500 bg-blue-50': freelancerType === type.label}"
                            >
                                <span class="text-2xl mr-3" x-text="type.icon"></span>
                                <span class="text-gray-700" x-text="type.label"></span>
                            </button>
                        </template>
                    </div>

                    <!-- Custom Type Input -->
                    <div x-show="freelancerType === 'Other'" class="mt-4">
                        <input 
                            type="text"
                            x-model="customFreelancerType"
                            placeholder="What type of freelancer are you?"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        >
                    </div>

                    <!-- Skip Link -->
                    <div class="mt-8 text-center">
                        <button 
                            @click="currentStep = 2"
                            class="text-sm text-gray-500 hover:text-gray-700 underline"
                        >
                            Skip this step
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Income Input -->
            <div x-show="currentStep === 2"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 class="max-w-md mx-auto px-4 py-8"
            >
                <div class="bg-white shadow-md rounded-2xl p-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">What's your income?</h2>
                    <p class="text-gray-600 mb-6">Enter your freelance earnings below.</p>

                    <!-- Income Input -->
                    <div class="relative mb-6">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">¬£</span>
                        </div>
                        <input
                            type="text"
                            x-model="income"
                            @input="income = $event.target.value.replace(/[^0-9]/g, '')"
                            class="block w-full pl-7 pr-12 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="0"
                        >
                    </div>

                    <!-- Frequency Toggle -->
                    <div class="flex rounded-lg border-2 border-gray-200 p-1 mb-6">
                        <button 
                            @click="frequency = 'monthly'"
                            class="flex-1 py-2 px-4 rounded-md transition-colors duration-150"
                            :class="frequency === 'monthly' ? 'bg-blue-500 text-white' : 'text-gray-600 hover:bg-gray-100'"
                        >
                            Monthly
                        </button>
                        <button 
                            @click="frequency = 'annual'"
                            class="flex-1 py-2 px-4 rounded-md transition-colors duration-150"
                            :class="frequency === 'annual' ? 'bg-blue-500 text-white' : 'text-gray-600 hover:bg-gray-100'"
                        >
                            Annual
                        </button>
                    </div>

                    <!-- Income Help Tooltip -->
                    <div class="relative mb-8">
                        <button 
                            @click="showIncomeHelp = !showIncomeHelp"
                            class="text-sm text-gray-500 hover:text-gray-700 flex items-center"
                        >
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                            </svg>
                            Not sure what to enter?
                        </button>
                        <div 
                            x-show="showIncomeHelp"
                            @click.away="showIncomeHelp = false"
                            class="absolute bottom-full left-0 mb-2 w-64 p-3 bg-gray-800 text-white text-sm rounded-lg shadow-lg"
                        >
                            Use your average if your income varies month to month.
                            <div class="absolute bottom-0 left-4 transform translate-y-1/2 w-2 h-2 bg-gray-800 rotate-45"></div>
                        </div>
                    </div>

                    <!-- Continue Button -->
                    <button 
                        @click="submitIncome()"
                        class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors duration-150 disabled:opacity-50 disabled:cursor-not-allowed"
                        :disabled="!income"
                    >
                        Calculate My Tax
                    </button>

                    <!-- Back Link -->
                    <div class="mt-4 text-center">
                        <button 
                            @click="currentStep = 1"
                            class="text-sm text-gray-500 hover:text-gray-700 underline"
                        >
                            ‚Üê Back to previous step
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Results -->
            <div x-show="currentStep === 3" class="max-w-md mx-auto px-4 py-8">
                <!-- Monthly Savings Card -->
                <div class="bg-white shadow-md rounded-2xl p-8 mb-6">
                    <div class="text-center">
                        <h2 class="text-gray-600 text-lg mb-2">Your Monthly Savings Target</h2>
                        <div class="text-4xl font-bold text-blue-600 mb-3">
                            ¬£<span x-text="results.monthlySetAside"></span>
                        </div>
                        <div class="relative inline-block">
                            <button 
                                @click="showExplanation = !showExplanation"
                                class="text-sm text-blue-600 hover:text-blue-700 underline focus:outline-none"
                            >
                                What does this number mean?
                            </button>
                            <div 
                                x-show="showExplanation" 
                                @click.away="showExplanation = false"
                                class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-4 bg-gray-800 text-white text-sm rounded-lg shadow-lg"
                            >
                                This is how much you should save monthly to cover your estimated tax bill by the end of the tax year (April 5th).
                                <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 w-2 h-2 bg-gray-800 rotate-45"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tax Breakdown Card -->
                <div class="bg-white shadow-md rounded-2xl p-8">
                    <h3 class="text-gray-800 font-semibold mb-6">Tax Breakdown</h3>
                    
                    <!-- Tax Items -->
                    <div class="space-y-4">
                        <!-- Income Tax -->
                        <div class="group relative">
                            <div class="flex justify-between items-center p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors">
                                <div>
                                    <span class="text-gray-700">Income Tax</span>
                                    <div class="hidden group-hover:block absolute left-0 top-full mt-2 w-64 p-3 bg-gray-800 text-white text-sm rounded-lg shadow-lg z-10">
                                        Tax on your earnings after the personal allowance
                                    </div>
                                </div>
                                <span class="text-gray-900 font-medium">¬£<span x-text="results.incomeTax"></span></span>
                            </div>
                        </div>

                        <!-- Class 2 NI -->
                        <div class="group relative">
                            <div class="flex justify-between items-center p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors">
                                <div>
                                    <span class="text-gray-700">Class 2 NI</span>
                                    <div class="hidden group-hover:block absolute left-0 top-full mt-2 w-64 p-3 bg-gray-800 text-white text-sm rounded-lg shadow-lg z-10">
                                        A small weekly flat-rate payment if you earn more than ¬£6,725
                                    </div>
                                </div>
                                <span class="text-gray-900 font-medium">¬£<span x-text="results.class2NI"></span></span>
                            </div>
                        </div>

                        <!-- Class 4 NI -->
                        <div class="group relative">
                            <div class="flex justify-between items-center p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors">
                                <div>
                                    <span class="text-gray-700">Class 4 NI</span>
                                    <div class="hidden group-hover:block absolute left-0 top-full mt-2 w-64 p-3 bg-gray-800 text-white text-sm rounded-lg shadow-lg z-10">
                                        A percentage of your profits over ¬£12,570
                                    </div>
                                </div>
                                <span class="text-gray-900 font-medium">¬£<span x-text="results.class4NI"></span></span>
                            </div>
                        </div>

                        <!-- Total -->
                        <div class="mt-6 pt-4 border-t border-gray-100">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-800 font-semibold">Total Tax</span>
                                <span class="text-blue-600 text-xl font-bold">¬£<span x-text="results.total"></span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- See What's Next Button -->
                <div class="text-center mt-8">
                    <button 
                        @click="showWaitlist = true"
                        class="inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                    >
                        <span>See What's Next</span>
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Waitlist Modal -->
        <div 
            x-show="showWaitlist" 
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform translate-y-4"
            x-transition:enter-end="opacity-100 transform translate-y-0"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
            @click.self="showWaitlist = false"
        >
            <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full mx-auto p-8 relative">
                <!-- Close Button -->
                <button 
                    @click="showWaitlist = false" 
                    class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                >
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>

                <!-- Content -->
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Thanks for Using Taxulator!</h2>
                    <p class="text-gray-600 mb-6">You've just used our basic calculator. Want to be notified when the full version launches?</p>

                    <!-- Feature List -->
                    <div class="bg-blue-50 rounded-xl p-6 mb-8 text-left">
                        <h3 class="font-semibold text-blue-800 mb-4">Coming Soon in Taxulator Pro:</h3>
                        <ul class="space-y-3">
                            <li class="flex items-start">
                                <svg class="w-5 h-5 text-blue-500 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span class="text-gray-700">Smart expense tracking with category suggestions</span>
                            </li>
                            <li class="flex items-start">
                                <svg class="w-5 h-5 text-blue-500 mr-2 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span class="text-gray-700">Tax deadline reminders and notifications</span>
                            </li>
                            <li class="flex items-start">
                                <svg class="w-5 h-5 text-blue-500 mr-2 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span class="text-gray-700">Self Assessment preparation assistance</span>
                            </li>
                            <li class="flex items-start">
                                <svg class="w-5 h-5 text-blue-500 mr-2 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span class="text-gray-700">Personalized tax-saving tips for your industry</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Email Form -->
                    <div class="max-w-sm mx-auto">
                        <form @submit.prevent="joinWaitlist()" class="space-y-4">
                            <div class="relative">
                                <input 
                                    type="email" 
                                    x-model="waitlistEmail"
                                    placeholder="Enter your email"
                                    :disabled="waitlistLoading || waitlistSuccess"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"
                                    :class="{'border-red-300': waitlistError}"
                                >
                            </div>

                            <button
                                type="submit"
                                class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg transition-colors duration-150 relative"
                                :class="{
                                    'hover:bg-blue-700': !waitlistLoading && !waitlistSuccess,
                                    'bg-green-600 hover:bg-green-600': waitlistSuccess,
                                    'opacity-75 cursor-not-allowed': waitlistLoading
                                }"
                                :disabled="waitlistLoading || waitlistSuccess"
                            >
                                <!-- Loading Spinner -->
                                <span x-show="waitlistLoading" class="absolute inset-0 flex items-center justify-center">
                                    <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                </span>
                                
                                <!-- Button Text -->
                                <span x-show="!waitlistLoading">
                                    <span x-show="!waitlistSuccess">Notify Me When It's Live</span>
                                    <span x-show="waitlistSuccess">‚úÖ You're on the list!</span>
                                </span>
                            </button>

                            <!-- Error Message -->
                            <div 
                                x-show="waitlistError" 
                                x-text="waitlistError"
                                class="text-red-600 text-sm mt-2"
                            ></div>

                            <!-- Success Message -->
                            <div 
                                x-show="waitlistSuccess" 
                                class="text-green-600 text-sm mt-2"
                            >
                                We'll keep you updated on the launch!
                            </div>

                            <p class="text-gray-500 text-sm mt-4">No spam. Just helpful updates.</p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- For debugging -->
    <script>
        document.addEventListener('alpine:init', () => {
            console.log('Alpine.js initialized');
        });
    </script>

    <style>
        [x-cloak] { display: none !important; }
    </style>
</body>
</html>
